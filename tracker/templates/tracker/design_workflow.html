{% extends 'main/base.html' %}
{% load static %}
{% block title %}Workflow Design{% endblock %}

{% block head %}
  <script type="text/javascript">
    {% if use_template %}
      const NODES = {{ template.get_nodes|safe }};
    {% else %}
      const NODES = {{ workflow.get_nodes|safe }};
    {% endif %}
  </script>
  <script type="text/javascript" src="{% static 'tracker/js/design_workflow/bezier.js' %}"></script>
  <script type="text/javascript" src="{% static 'tracker/js/design_workflow/milestone.js' %}"></script>
  <script type="text/javascript" src="{% static 'tracker/js/design_workflow/design_workflow.js' %}"></script>
  <link rel="stylesheet" href="{% static 'tracker/css/design_workflow.css' %}">
{% endblock %}

{% block content %}
  <div id="main_container">
    <div class="title">
      {% if use_template %}Template{% else %}Workflow{% endif %} designen
    </div>
    <div id="content_container">
      <div id="node_container">
        <svg id="svg" xmlns="http://www.w3.org/2000/svg">
        </svg>
      </div>
      <div id="milestone_container">
        {% for milestone in milestones %}
          {{ milestone.to_html|safe }}
        {% endfor %}
      </div>
    </div>
    <div id="button_container">
      <div class="button" id="btn_save">
        Speichern
      </div>
      <div class="button" id="btn_add_task">
        Task hinzuf√ºgen
      </div>
    </div>
  </div>
  <div hidden>
    <div class="milestone noselect" id="milestone_js_template">
      <div class="milestone_name"></div>
      <div class="milestone_duration"></div>
      <div class="milestone_department"></div>
      <span class="dot left"></span>
      <span class="dot right"></span>
      <span class="dot bottom"></span>
    </div>
  </div>
  <div id="hidden_div" hidden></div>{# wird im javascript abused #}
{% endblock %}

{% block forms %}
<form action="{% if use_template %}{% url 'tracker:edit_template' template.id campaign_id %}{% else %}{% url 'tracker:design_workflow' campaign.id %}{% endif %}" method="post" id="data_form" hidden>
  {% csrf_token %}
  <input type="text" name="data" id="form_data_input">
</form>
{% endblock %}

{% block popup_title %}
  Neuen Task erstellen
{% endblock %}

{% block popup_content %}
  <form action="{% url 'tracker:bg_new_milestone' campaign.id|default:0 %}" id="new_milestone_form" method="POST">
    <table id="new_milestone_table">
        {{ form.as_table }}
    </table>
    {% csrf_token %}
  </form>
  
  <div class="button" onclick="submit_milestone_form();">
    Erstellen
  </div>
{% endblock %}